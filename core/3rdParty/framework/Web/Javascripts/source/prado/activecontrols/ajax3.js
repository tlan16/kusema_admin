Prado.AjaxRequest=Class.create();Prado.AjaxRequest.prototype=Object.clone(Ajax.Request.prototype);
Object.extend(Prado.AjaxRequest.prototype,{respondToReadyState:function(a){a=Ajax.Request.Events[a];var b=this.transport,c=this.getBodyDataPart(Prado.CallbackRequest.DATA_HEADER);if("Complete"==a){var d=this.getBodyContentPart(Prado.CallbackRequest.REDIRECT_HEADER);d&&(document.location.href=d);if((this.getHeader("Content-type")||"").match(/^text\/javascript/i))try{c=eval("("+b.responseText+")")}catch(e){"string"==typeof c&&(c=Prado.CallbackRequest.decode(result))}try{Prado.CallbackRequest.updatePageState(this,
b);Prado.CallbackRequest.checkHiddenFields(this,b);var f=this;Prado.CallbackRequest.loadAssets(this,b,function(){try{Ajax.Responders.dispatch("on"+b.status,f,b,c),Prado.CallbackRequest.dispatchActions(b,f.getBodyDataPart(Prado.CallbackRequest.ACTION_HEADER)),(f.options["on"+f.transport.status]||f.options["on"+(f.success()?"Success":"Failure")]||Prototype.emptyFunction)(f,c)}catch(a){f.dispatchException(a)}})}catch(e){this.dispatchException(e)}}try{(this.options["on"+a]||Prototype.emptyFunction)(this,
c),Ajax.Responders.dispatch("on"+a,this,b,c)}catch(e){this.dispatchException(e)}"Complete"==a&&(this.transport.onreadystatechange=Prototype.emptyFunction)},getHeaderData:function(a){return this.getJsonData(this.getHeader(a))},getBodyContentPart:function(a){if("string"==typeof this.transport.responseText)return Prado.Element.extractContent(this.transport.responseText,a)},getJsonData:function(a){try{return eval("("+a+")")}catch(b){if("string"==typeof a)return Prado.CallbackRequest.decode(a)}},getBodyDataPart:function(a){return this.getJsonData(this.getBodyContentPart(a))}});
Prado.CallbackRequest=Class.create();
Object.extend(Prado.CallbackRequest,{FIELD_CALLBACK_TARGET:"PRADO_CALLBACK_TARGET",FIELD_CALLBACK_PARAMETER:"PRADO_CALLBACK_PARAMETER",FIELD_CALLBACK_PAGESTATE:"PRADO_PAGESTATE",FIELD_POSTBACK_TARGET:"PRADO_POSTBACK_TARGET",FIELD_POSTBACK_PARAMETER:"PRADO_POSTBACK_PARAMETER",PostDataLoaders:[],DATA_HEADER:"X-PRADO-DATA",ACTION_HEADER:"X-PRADO-ACTIONS",ERROR_HEADER:"X-PRADO-ERROR",PAGESTATE_HEADER:"X-PRADO-PAGESTATE",SCRIPTLIST_HEADER:"X-PRADO-SCRIPTLIST",STYLESHEET_HEADER:"X-PRADO-STYLESHEET",STYLESHEETLIST_HEADER:"X-PRADO-STYLESHEETLIST",
HIDDENFIELDLIST_HEADER:"X-PRADO-HIDDENFIELDLIST",REDIRECT_HEADER:"X-PRADO-REDIRECT",requestQueue:[],requests:{},getRequestById:function(a){var b=Prado.CallbackRequest.requests;if("undefined"!=typeof b[a])return b[a]},dispatch:function(a){var b=Prado.CallbackRequest.requests;"undefined"!=typeof b[a]&&b[a].dispatch()},addPostLoaders:function(a){var b=Prado.CallbackRequest;b.PostDataLoaders=b.PostDataLoaders.concat(a);var c=[];b.PostDataLoaders.each(function(a){0>c.indexOf(a)&&c.push(a)});b.PostDataLoaders=
c},dispatchActions:function(a,b){var c=Prado.CallbackRequest;b&&0<b.length&&b.each(c.__run.bind(c,a))},__run:function(a,b){var c=Prado.CallbackRequest;c.transport=a;for(var d in b)try{d.toFunction().apply(c,b[d])}catch(e){if("undefined"!=typeof Logger)c.Exception.onException(null,e);else debugger}},Exception:{on500:function(a,b,c){(a=a.getHeaderData(Prado.CallbackRequest.ERROR_HEADER))?Logger.error("Callback Server Error "+a.code,this.formatException(a)):Logger.error("Callback Server Error Unknown",
"")},on200:function(a,b,c){if(500>b.status){var d="HTTP "+b.status+" with response : \n";0<b.responseText.trim().length&&(d+=b.responseText.replace(/(\x3c!--X-PRADO[^>]+--\x3e)([\s\S\w\W]*)(\x3c!--\/\/X-PRADO[^>]+--\x3e)/m,"")+"\n");"undefined"!=typeof c&&null!=c&&(d+="Data : \n"+inspect(c)+"\n");(c=a.getBodyDataPart(Prado.CallbackRequest.ACTION_HEADER))&&0<c.length&&(d+="Actions : \n",c.each(function(a){d+=inspect(a)+"\n"}));Logger.info(d)}},onException:function(a,b){var c="";$H(b).each(function(a){c+=
a.key+": "+a.value+"\n"});Logger.error("Uncaught Callback Client Exception:",c)},formatException:function(a){for(var b=a.type+' with message "'+a.message+'"',b=b+(" in "+a.file+"("+a.line+")\n"),b=b+"Stack trace:\n",c=a.trace,d=0;d<c.length;d++)b+="  #"+d+" "+c[d].file,b+="("+c[d].line+"): ",b+=c[d]["class"]+"->"+c[d]["function"]+"()\n";return b+=a.version+" "+a.time+"\n"}},encode:function(a){return Prado.JSON.stringify(a)},decode:function(a){return"string"==typeof a&&0<a.trim().length?Prado.JSON.parse(a):
null},dispatchNormalRequest:function(a){a.options.postBody=a._getPostData();a.request(a.url);return!0},tryNextRequest:function(){var a=Prado.CallbackRequest;if(("undefined"==typeof a.currentRequest||null==a.currentRequest)&&0<a.requestQueue.length)return a.dispatchQueue()},loadScripts:function(a,b,c){a=a.getBodyContentPart(Prado.CallbackRequest.SCRIPTLIST_HEADER);this.ScriptsToLoad||(this.ScriptsToLoad=[]);this.ScriptLoadFinishedCallback=c;if("string"==typeof a&&0<a.length)if(json=Prado.CallbackRequest.decode(a),
"object"!=typeof json)Logger.warn("Invalid script list:"+a);else for(var d in json)/^\d+$/.test(d)&&(c=json[d],Prado.ScriptManager.isAssetLoaded(c)||this.ScriptsToLoad.push(c));this.loadNextScript()},loadNextScript:function(){if(this.ScriptsToLoad&&0!=this.ScriptsToLoad.length){var a=this.ScriptsToLoad.shift(),b=this;Prado.ScriptManager.ensureAssetIsLoaded(a,function(){b.loadNextScript()})&&this.loadNextScript()}else this.ScriptLoadFinishedCallback&&(a=this.ScriptLoadFinishedCallback,this.ScriptLoadFinishedCallback=
null,a())},loadStyleSheetsCode:function(a,b){var c=a.getBodyContentPart(Prado.CallbackRequest.STYLESHEET_HEADER);if("string"==typeof c&&0<c.length)if(json=Prado.CallbackRequest.decode(c),"object"!=typeof json)Logger.warn("Invalid stylesheet list:"+c);else for(var d in json)/^\d+$/.test(d)&&Prado.StyleSheetManager.createStyleSheetCode(json[d],null)},loadStyleSheetsAsync:function(a,b){var c=a.getBodyContentPart(Prado.CallbackRequest.STYLESHEETLIST_HEADER);if("string"==typeof c&&0<c.length)if(json=Prado.CallbackRequest.decode(c),
"object"!=typeof json)Logger.warn("Invalid stylesheet list:"+c);else for(var d in json)/^\d+$/.test(d)&&Prado.StyleSheetManager.ensureAssetIsLoaded(json[d],null)},loadStyleSheets:function(a,b,c){a=a.getBodyContentPart(Prado.CallbackRequest.STYLESHEETLIST_HEADER);this.StyleSheetsToLoad||(this.StyleSheetsToLoad=[]);this.StyleSheetLoadFinishedCallback=c;if("string"==typeof a&&0<a.length)if(json=Prado.CallbackRequest.decode(a),"object"!=typeof json)Logger.warn("Invalid stylesheet list:"+a);else for(var d in json)/^\d+$/.test(d)&&
(c=json[d],Prado.StyleSheetManager.isAssetLoaded(c)||this.StyleSheetsToLoad.push(c));this.loadNextStyleSheet()},loadNextStyleSheet:function(){if(this.StyleSheetsToLoad&&0!=this.StyleSheetsToLoad.length){var a=this.StyleSheetsToLoad.shift(),b=this;Prado.StyleSheetManager.ensureAssetIsLoaded(a,function(){b.loadNextStyleSheet()})&&this.loadNextStyleSheet()}else this.StyleSheetLoadFinishedCallback&&(a=this.StyleSheetLoadFinishedCallback,this.StyleSheetLoadFinishedCallback=null,a())},loadAssets:function(a,
b,c){this.loadStyleSheetsCode(a,b);this.loadStyleSheetsAsync(a,b);this.loadScripts(a,b,c)},checkHiddenField:function(a,b){var c=a.replace(":","_");if(!document.getElementById(c)){var d=document.createElement("input");d.setAttribute("type","hidden");d.id=c;d.name=a;d.value=b;document.body.appendChild(d)}},checkHiddenFields:function(a,b){var c=a.getBodyContentPart(Prado.CallbackRequest.HIDDENFIELDLIST_HEADER);if("string"==typeof c&&0<c.length)if(json=Prado.CallbackRequest.decode(c),"object"!=typeof json)Logger.warn("Invalid hidden field list:"+
c);else for(var d in json)this.checkHiddenField(d,json[d])},updatePageState:function(a,b){var c=Prado.CallbackRequest,d=$(c.FIELD_CALLBACK_PAGESTATE),e="undefined"==typeof c.currentRequest||null==c.currentRequest;if(a.ActiveControl.EnablePageStateUpdate&&a.ActiveControl.HasPriority&&!e&&d)if(e=a.getBodyContentPart(c.PAGESTATE_HEADER),"string"==typeof e&&0<e.length)d.value=e;else return"undefined"!=typeof Logger&&Logger.warn("Missing page state:"+e),c.endCurrentRequest(),!1;c.endCurrentRequest();return!0},
enqueue:function(a){var b=Prado.CallbackRequest;b.requestQueue.push(a);b.tryNextRequest()},dispatchQueue:function(){var a=Prado.CallbackRequest,b=a.requestQueue.shift();a.currentRequest=b;b.options.postBody=b._getPostData();b.timeout=setTimeout(function(){a.abortRequest(b.id)},b.ActiveControl.RequestTimeOut);b.request(b.url)},endCurrentRequest:function(){var a=Prado.CallbackRequest;"undefined"!=typeof a.currentRequest&&null!=a.currentRequest&&clearTimeout(a.currentRequest.timeout);a.currentRequest=
null},abortRequest:function(a){var b=Prado.CallbackRequest;"undefined"!=typeof b.currentRequest&&null!=b.currentRequest&&b.currentRequest.id==a&&(a=b.currentRequest,4>a.transport.readyState&&a.transport.abort(),b.endCurrentRequest());b.tryNextRequest()}});Ajax.Responders.register({onComplete:function(a){a&&a instanceof Prado.AjaxRequest&&a.ActiveControl.HasPriority&&Prado.CallbackRequest.tryNextRequest()}});Event.OnLoad(function(){"undefined"!=typeof Logger&&Ajax.Responders.register(Prado.CallbackRequest.Exception)});
Prado.CallbackRequest.prototype=Object.extend(Prado.AjaxRequest.prototype,{initialize:function(a,b){this.url=this.getCallbackUrl();this.transport=Ajax.getTransport();this.Enabled=!0;this.id=a;this.randomId=this.randomString();"string"==typeof a&&(Prado.CallbackRequest.requests[a+"__"+this.randomId]=this);this.setOptions(Object.extend({RequestTimeOut:3E4,EnablePageStateUpdate:!0,HasPriority:!0,CausesValidation:!0,ValidationGroup:null,PostInputs:!0},b||{}));this.ActiveControl=this.options;Prado.CallbackRequest.requests[a+
"__"+this.randomId].ActiveControl=this.options},setOptions:function(a){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();Object.isString(this.options.parameters)&&(this.options.parameters=this.options.parameters.toQueryParams())},getCallbackUrl:function(){return $("PRADO_PAGESTATE").form.action},setCallbackParameter:function(a){var b=
this.id+"__"+this.randomId;this.ActiveControl.CallbackParameter=a;Prado.CallbackRequest.requests[b].ActiveControl.CallbackParameter=a},getCallbackParameter:function(){return Prado.CallbackRequest.requests[this.id+"__"+this.randomId].ActiveControl.CallbackParameter},setRequestTimeOut:function(a){this.ActiveControl.RequestTimeOut=a},getRequestTimeOut:function(){return this.ActiveControl.RequestTimeOut},setCausesValidation:function(a){this.ActiveControl.CausesValidation=a},getCausesValidation:function(){return this.ActiveControl.CausesValidation},
setValidationGroup:function(a){this.ActiveControl.ValidationGroup=a},getValidationGroup:function(){return this.ActiveControl.ValidationGroup},dispatch:function(){"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();if(this.ActiveControl.CausesValidation&&"undefined"!=typeof Prado.Validation){var a=this.ActiveControl.Form||Prado.Validation.getForm();if(0==Prado.Validation.validate(a,this.ActiveControl.ValidationGroup,this))return!1}if(this.ActiveControl.onPreDispatch)this.ActiveControl.onPreDispatch(this,
null);if(this.Enabled)return Prototype.Browser.Opera&&(this.ActiveControl.onLoading&&(this.ActiveControl.onLoading(this,null),Ajax.Responders.dispatch("onLoading",this,this.transport,null)),this.ActiveControl.onLoaded&&(this.ActiveControl.onLoaded(this,null),Ajax.Responders.dispatch("onLoaded",this,this.transport,null))),this.ActiveControl.HasPriority?Prado.CallbackRequest.enqueue(this):Prado.CallbackRequest.dispatchNormalRequest(this)},abort:function(){return Prado.CallbackRequest.abortRequest(this.id)},
_getPostData:function(){var a={},b=Prado.CallbackRequest;0!=this.ActiveControl.PostInputs&&b.PostDataLoaders.each(function(b){var c=$A(document.getElementsByName(b));0==c.size()&&(b+="[]",c=$A(document.getElementsByName(b)));c.each(function(c){c.type&&c.name==b&&(c=$F(c),"undefined"!=typeof c&&null!=c&&(a[b]=c))})});"undefined"!=typeof this.ActiveControl.CallbackParameter&&(a[b.FIELD_CALLBACK_PARAMETER]=b.encode(this.getCallbackParameter()));var c=$F(b.FIELD_CALLBACK_PAGESTATE);"undefined"!=typeof c&&
(a[b.FIELD_CALLBACK_PAGESTATE]=c);a[b.FIELD_CALLBACK_TARGET]=this.id;this.ActiveControl.EventTarget&&(a[b.FIELD_POSTBACK_TARGET]=this.ActiveControl.EventTarget);this.ActiveControl.EventParameter&&(a[b.FIELD_POSTBACK_PARAMETER]=this.ActiveControl.EventParameter);return $H(a).toQueryString()},randomString:function(){chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";randomString="";for(x=0;8>x;x++)randomString+=chars.charAt(Math.floor(62*Math.random()));return randomString}});
Prado.Callback=function(a,b,c,d){b={CallbackParameter:b||"",onSuccess:c||Prototype.emptyFunction};Object.extend(b,d||{});(new Prado.CallbackRequest(a,b)).dispatch();return!1};
"undefined"==typeof Prado.AssetManagerClass&&(Prado.AssetManagerClass=Class.create(),Prado.AssetManagerClass.prototype={initialize:function(){this.loadedAssets=[];this.discoverLoadedAssets()},discoverLoadedAssets:function(){if(document.body)for(var a=this.findAssetUrlsInMarkup(),b=0;b<a.length;b++)this.markAssetAsLoaded(a[b])},makeFullUrl:function(a){this.baseUri||(this.baseUri=window.location);if(-1==a.indexOf("://")){var b=document.createElement("a");b.href=a;-1!=b.href.indexOf("://")?a=b.href:
(a=b.pathname,"/"!=a.substr(0,1)&&(a="/"+a),a=this.baseUri.protocol+"//"+this.baseUri.host+a)}return a},isAssetLoaded:function(a){a=this.makeFullUrl(a);return-1!=this.loadedAssets.indexOf(a)},markAssetAsLoaded:function(a){a=this.makeFullUrl(a);-1==this.loadedAssets.indexOf(a)&&this.loadedAssets.push(a)},assetReadyStateChanged:function(a,b,c,d){!d&&"loaded"!=b.readyState&&"complete"!=b.readyState||b.assetCallbackFired||(b.assetCallbackFired=!0,c(a,b))},assetLoadFailed:function(a,b,c){debugger;b.assetCallbackFired=
!0;"undefined"!=typeof Logger&&Logger.error("Failed to load asset: "+a,this);b.assetCallbackFired||c(a,b,!1)},startAssetLoad:function(a,b){var c=this.createAssetElement(a);b&&(c.onreadystatechange=this.assetReadyStateChanged.bind(this,a,c,b,!1),c.onload=this.assetReadyStateChanged.bind(this,a,c,b,!0),c.onerror=this.assetLoadFailed.bind(this,a,c,b),c.assetCallbackFired=!1);document.getElementsByTagName("head")[0].appendChild(c);this.markAssetAsLoaded(a);return 0!=b},ensureAssetIsLoaded:function(a,
b){a=this.makeFullUrl(a);return-1==this.loadedAssets.indexOf(a)?(this.startAssetLoad(a,b),!1):!0}});Prado.ScriptManagerClass=Class.extend(Prado.AssetManagerClass,{findAssetUrlsInMarkup:function(){for(var a=[],b=document.getElementsByTagName("script"),c=0;c<b.length;c++){var d=b[c].src;""!=d&&a.push(d)}return a},createAssetElement:function(a){var b=document.createElement("script");b.type="text/javascript";b.src=a;return b}});
Prado.StyleSheetManagerClass=Class.extend(Prado.AssetManagerClass,{findAssetUrlsInMarkup:function(){for(var a=[],b=document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c],e=d.href;"stylesheet"==d.rel&&0<e.length&&a.push(e)}return a},createAssetElement:function(a){var b=document.createElement("link");b.rel="stylesheet";b.media="screen";b.setAttribute("type","text/css");b.href=a;return b},createStyleSheetCode:function(a){var b=document.createElement("style");b.setAttribute("type","text/css");
b.styleSheet?b.styleSheet.cssText=a:(a=document.createTextNode(a),b.appendChild(a));document.getElementsByTagName("head")[0].appendChild(b)}});"undefined"==typeof Prado.ScriptManager&&(Prado.ScriptManager=new Prado.ScriptManagerClass);"undefined"==typeof Prado.StyleSheetManager&&(Prado.StyleSheetManager=new Prado.StyleSheetManagerClass);var discover=function(){Prado.ScriptManager.discoverLoadedAssets();Prado.StyleSheetManager.discoverLoadedAssets()};
window.attachEvent?window.attachEvent("onload",discover):window.addEventListener&&window.addEventListener("load",discover,!1);