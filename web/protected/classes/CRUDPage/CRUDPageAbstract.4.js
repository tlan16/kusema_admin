var CRUDPageJs=new Class.create;
CRUDPageJs.prototype=Object.extend(new BPCPageJs,{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},_nextPageColSpan:5,setHTMLIds:function(c,d,a){this.resultDivId=c;this.searchDivId=d;this.totalNoOfItemsId=a;return this},getSearchCriteria:function(){var c,d;c=this;null===c._searchCriteria&&(c._searchCriteria={});d=!0;$(c.searchDivId).getElementsBySelector("[search_field]").each(function(a){c._searchCriteria[a.readAttribute("search_field")]=$F(a);
if($F(a)instanceof Array&&0<$F(a).size()||"string"===typeof $F(a)&&!$F(a).blank())d=!1});!0===d&&(c._searchCriteria=null);return this},getResults:function(c,d){var a,b,e,f,g;a=this;b=c||!1;e=$(a.resultDivId);!0===b&&(a._pagination.pageNo=1);a._pagination.pageSize=d||a._pagination.pageSize;a.postAjax(a.getCallbackId("getItems"),{pagination:a._pagination,searchCriteria:a._searchCriteria},{onLoading:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("loading");!0===b&&e.update("").addClassName("list-group").insert({bottom:new Element("div",
{"class":"container-fluid",id:a.resultDivId+"-head"})}).insert({bottom:new Element("div",{"class":"container-fluid",id:a.resultDivId+"-body"})}).insert({bottom:a.getLoadingImg()})},onSuccess:function(c,d){try{if(f=a.getResp(d,!1,!0))$(a.totalNoOfItemsId).update(f.pageStats.totalRows),!0===b&&(e.down("#"+a.resultDivId+"-head").insert({bottom:a._getResultRow(a._getTitleRowData(),!0).addClassName("list-group-item").setStyle("font-weight: bold;")}),f.items&&0!==f.items.size()||e.insert({bottom:a.getAlertBox("Nothing found.",
"").addClassName("alert-warning")})),e.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),g=$(e).down("#"+a.resultDivId+"-body"),f.items.each(function(b){g.insert({bottom:a._getResultRow(b).addClassName("list-group-item").addClassName("list-group-item").addClassName("item_row").writeAttribute("item_id",b.id)})}),f.pageStats.pageNumber<f.pageStats.totalPages&&e.insert({bottom:a._getNextPageBtn().addClassName("paginWrapper")})}catch(l){e.insert({bottom:a.getAlertBox("Error",l).addClassName("alert-danger")})}},
onComplete:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("reset");e.getElementsBySelector(".loading-img").each(function(a){a.remove()});return a}})},_getNextPageBtn:function(){var c;c=this;return(new Element("tfoot")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:c._nextPageColSpan,"class":"text-center"})).insert({bottom:(new Element("span",{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."})).update("Show More").observe("click",function(){c._pagination.pageNo=
1*c._pagination.pageNo+1;jQuery(this).button("loading");c.getResults()})})})})},_saveItem:function(c,d,a){var b,e,f,g,h;b=this;e=b._collectFormData(d,a);if(null!==e)return b.postAjax(b.getCallbackId("saveItem"),{item:e},{onLoading:function(){e.id&&d.addClassName("item_row").writeAttribute("item_id",e.id);d.hide()},onSuccess:function(a,c){try{(f=b.getResp(c,!1,!0))&&f.item&&(g=$(b.resultDivId).down("#"+b.resultDivId+"-body").down(".item_row[item_id="+f.item.id+"]"),h=b._getResultRow(f.item).addClassName("item_row").writeAttribute("item_id",
f.item.id),g?g.replace(h):($(b.resultDivId).down("tbody").insert({top:h}),d.remove(),$(b.totalNoOfItemsId).update(1*$(b.totalNoOfItemsId).innerHTML+1)))}catch(e){b.showModalBox('<span class="text-danger">ERROR:</span>',e,!0),d.show()}}}),b},_deleteItem:function(c,d){var a,b,e,f;a=this;b=$(a.resultDivId).down("#"+a.resultDivId+"-body").down(".item_row[item_id="+c.id+"]");a.postAjax(a.getCallbackId("deleteItems"),{ids:[c.id],deactivate:!0===d},{onLoading:function(){b&&b.hide()},onSuccess:function(c,
d){try{if(e=a.getResp(d,!1,!0))f=1*$(a.totalNoOfItemsId).innerHTML-1,$(a.totalNoOfItemsId).update(0>=f?0:f),b&&b.remove()}catch(k){a.showModalBox('<span class="text-danger">ERROR</span>',k,!0),b&&b.show()}}});return a}});